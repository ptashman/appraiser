class Property < ActiveRecord::Base
	
	SAMPLE_ROOM_DEMANDS = [0, 0, 0, 1, 1, 2, 2, 3, 4, 4, 5, 5, 5, 5, 6, 6, 6, 7, 7, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10, 11, 12, 13, 13, 14, 14, 14, 15, 15, 17, 19, 19, 19, 19, 19, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 26, 26, 27, 28, 28, 28, 28, 29, 29, 29, 30, 30, 30, 30, 30, 30, 31, 31, 31, 31, 31, 33, 33, 33, 34, 34, 34, 34, 34, 34, 34, 34, 35, 35, 35, 36, 36, 36, 36, 36, 36, 36, 37, 37, 37, 37, 37, 38, 38, 38, 38, 39, 39, 40, 40, 40, 40, 40, 40, 40, 41, 41, 41, 41, 42, 42, 42, 42, 43, 43, 43, 44, 44, 44, 44, 44, 45, 45, 45, 46, 46, 46, 46, 46, 46, 46, 47, 47, 47, 47, 47, 48, 48, 48, 48, 48, 48, 48, 49, 49, 49, 49, 50, 50, 50, 50, 50, 50, 50, 51, 51, 51, 51, 51, 52, 53, 54, 54, 54, 55, 55, 55, 55, 55, 55, 56, 56, 57, 57, 57, 57, 58, 58, 58, 59, 59, 59, 59, 59, 59, 60, 60, 61, 61, 61, 61, 61, 61, 61, 61, 62, 62, 62, 62, 62, 62, 62, 63, 63, 63, 63, 64, 64, 64, 64, 64, 64, 64, 65, 65, 65, 66, 66, 66, 66, 66, 66, 67, 68, 68, 68, 69, 69, 69, 69, 69, 69, 69, 69, 69, 69, 70, 70, 71, 71, 71, 71, 72, 72, 72, 73, 73, 74, 74, 74, 74, 74, 75, 76, 76, 77, 78, 78, 78, 78, 78, 78, 79, 79, 79, 79, 79, 80, 81, 81, 81, 81, 81, 81, 82, 82, 82, 82, 82, 83, 83, 84, 84, 84, 85, 86, 86, 86, 87, 87, 87, 88, 88, 88, 88, 88, 88, 89, 89, 89, 89, 90, 90, 90, 90, 91, 91, 91, 91, 91, 91, 92, 92, 93, 94, 94, 96, 96, 96, 96, 96, 97, 97, 98, 98, 98, 98, 100, 101, 101, 101, 101, 102, 103, 103, 104, 104, 104, 105, 105, 105, 106, 106, 107, 108, 108, 109, 109, 109, 109, 109, 110, 110, 110, 111, 111, 112, 112, 112, 113, 114, 115, 115, 116, 118, 118, 119, 120, 120, 121, 121, 121, 122, 122, 122, 122, 123, 123, 124, 124, 125, 125, 126, 126, 126, 128, 128, 128, 128, 128, 129, 131, 132, 133, 133, 134, 134, 135, 136, 136, 136, 137, 139, 139, 140, 140, 140, 141, 141, 142, 143, 144, 144, 144, 144, 146, 146, 146, 146, 147, 147, 148, 148, 150, 151, 151, 152, 152, 152, 153, 153, 154, 154, 154, 154, 155, 155, 155, 155, 156, 156, 157, 157, 158, 158, 159, 159, 160, 161, 161, 163, 164, 164, 164, 164, 165, 166, 166, 167, 167, 168, 168, 168, 169, 169, 169, 170, 171, 171, 172, 173, 174, 174, 174, 175, 175, 175, 176, 177, 177, 177, 178, 179, 179, 180, 183, 184, 185, 185, 186, 187, 187, 187, 187, 187, 189, 189, 189, 190, 191, 192, 192, 192, 192, 193, 194, 195, 196, 196, 197, 198, 198, 199, 200, 200, 201, 201, 202, 203, 205, 205, 206, 207, 208, 209, 209, 210, 212, 213, 214, 214, 214, 214, 216, 218, 219, 225, 225, 225, 226, 227, 228, 229, 229, 233, 234, 234, 235, 235, 235, 237, 239, 239, 241, 243, 245, 246, 246, 250, 251, 251, 252, 255, 257, 257, 259, 260, 261, 262, 262, 267, 267, 269, 269, 270, 273, 273, 274, 276, 282, 283, 285, 289, 295, 296, 296, 296, 297, 302, 303, 303, 309, 314, 314, 314, 316, 316, 317, 319, 321, 322, 322, 328, 328, 329, 329, 330, 332, 332, 333, 335, 337, 337, 338, 340, 342, 344, 346, 353, 354, 357, 358, 360, 362, 364, 366, 366, 369, 372, 376, 376, 381, 382, 387, 389, 397, 399, 402, 406, 406, 411, 411, 412, 415, 418, 427, 428, 430, 431, 434, 434, 437, 440, 444, 447, 450, 453, 459, 463, 467, 467, 471, 474, 478, 479, 479, 489, 498, 499, 501, 502, 502, 503, 506, 508, 511, 513, 520, 520, 521, 522, 526, 527, 537, 537, 540, 542, 545, 546, 547, 551, 553, 556, 558, 561, 563, 570, 580, 586, 589, 590, 596, 596, 606, 615, 622, 633, 636, 655, 655, 656, 659, 662, 672, 673, 680, 684, 684, 697, 697, 700, 707, 707, 728, 748, 763, 793, 803, 811, 835, 841, 842, 850, 854, 886, 890, 896, 903, 997, 999, 1020, 1060, 1061, 1087, 1087, 1093, 1097, 1097, 1207, 1217, 1279, 1320, 1341, 1343, 1390, 1390, 1411, 1413, 1417, 1424, 1476, 1759, 1848, 1925, 1957, 2025, 2045, 2307, 2501, 2526, 2583, 2828, 2906, 3036, 3104, 3342, 3586, 3964, 4544, 4832, 4965, 5053, 5074, 5196, 5293, 5361, 5515, 5950, 5960, 6005, 6221, 6244, 6281, 6432, 6584, 6863, 7045, 7666, 7764, 8443, 8595, 8995, 9226, 9965, 10166, 10576, 11369, 11823, 12899, 14106, 15974, 16562, 18876] 
	SAMPLE_CAP_RATIOS = [0.001458565531214438, 0.0015306525351786856, 0.0015379577441991161, 0.0015379577441991161, 0.0015511751229991477, 0.0016213329264105597, 0.00163662256524934, 0.0016436613091856107, 0.001644461990163385, 0.0016518903791289518, 0.0016566759767000505, 0.0017622685765755963, 0.0017622685765755963, 0.0017671373836921334, 0.0018081892844437598, 0.0018403988517577095, 0.0018815162239940607, 0.0018851045177336616, 0.0018894618904272695, 0.0018894618904272695, 0.001925080126844122, 0.0019258961505722123, 0.0019258961505722123, 0.0019511171719290884, 0.001956222417702898, 0.0019828945372177774, 0.0020096633102180384, 0.0020122085052660817, 0.0020122085052660817, 0.0020202425021894907, 0.0020344045597773175, 0.0020534230915572782, 0.0020690753700103696, 0.0020690753700103696, 0.0020701136759321112, 0.002083058506176224, 0.0020835969562452757, 0.0020878208402823764, 0.0020921225128736143, 0.0021080429979624467, 0.0021080429979624467, 0.0021177038107526138, 0.0021196847624945503, 0.0021196847624945503, 0.0021317713640875277, 0.0021407520745065304, 0.002162440343293062, 0.0021931321453362127, 0.002207556398201867, 0.0022412690326754077, 0.0022412690326754077, 0.0022463069171639607, 0.002277601888496284, 0.002285188836472374, 0.0022895192671961674, 0.002304197462187981, 0.002309399571263791, 0.002309399571263791, 0.002319578313253012, 0.002319578313253012, 0.0023561145413332563, 0.002369209886568227, 0.0024009277178163573, 0.0024010430627752683, 0.002405154759373082, 0.0024152077194198878, 0.0024183584721002077, 0.0024410977013761383, 0.0024438764056281983, 0.0024438764056281983, 0.0024455593728875237, 0.0024455593728875237, 0.002446531842549438, 0.002451908627145128, 0.0024524524046052112, 0.0024524524046052112, 0.0024524524046052112, 0.00246377491187684, 0.00246377491187684, 0.0024860179550063965, 0.002490709580167359, 0.002490709580167359, 0.0024952448935938896, 0.0025116484389430256, 0.0025225252033235393, 0.0025240843860100896, 0.0025287857650571127, 0.0025287857650571127, 0.002542011621906621, 0.002542069222127593, 0.0025956817697414918, 0.0025956817697414918, 0.0025956817697414918, 0.0025980688949557807, 0.0026223911773044723, 0.002631187285410146, 0.002631187285410146, 0.0026343298769118087, 0.0026393988237582997, 0.0026442110399489916, 0.002656938503458642, 0.0026670032103387202, 0.002670194519788514, 0.002674320361867516, 0.0026792053319821974, 0.0027022520920403363, 0.00270720478274332, 0.00270720478274332, 0.0027421088323261677, 0.002745981408014379, 0.0027715817681787064, 0.0027957202900041394, 0.0028097095141961814, 0.002813788258486606, 0.0028270117069512076, 0.002827302792655433, 0.002827302792655433, 0.0028276009504695845, 0.0028276009504695845, 0.0028276009504695845, 0.00282848431708914, 0.002836840960997419, 0.00283958001666943, 0.002847247808817519, 0.002853300785039607, 0.0028561084481139795, 0.002863131774079195, 0.0028683906290759733, 0.0028722686861370325, 0.0028722686861370325, 0.002875029639693387, 0.002875029639693387, 0.0028804324473939657, 0.002883253367458723, 0.002883253367458723, 0.0028956547909329317, 0.0028956547909329317, 0.002899694305743295, 0.002906013578261248, 0.0029152305323591646, 0.0029152305323591646, 0.002924408617246225, 0.0029256757260654846, 0.0029356354387475186, 0.0029356354387475186, 0.002938353565186641, 0.002938353565186641, 0.002938353565186641, 0.0029397396720139608, 0.002940311344188663, 0.002946392280099199, 0.0029720482605733022, 0.0029764423806577394, 0.0029764423806577394, 0.0029848731837037873, 0.0029848731837037873, 0.002993131441377823, 0.002993131441377823, 0.0030020260242175126, 0.00300747487401802, 0.0030117072476793065, 0.003021796047600588, 0.0030238657060160205, 0.0030238657060160205, 0.003029494768822592, 0.00303008219061471, 0.003033568189953937, 0.0030416042496446615, 0.0030416042496446615, 0.003055008628188856, 0.0030559557406970098, 0.0030559557406970098, 0.0030596117913814494, 0.003063607836701237, 0.0030656252487852318, 0.003068446789516663, 0.0030913811268671923, 0.0030993367885065776, 0.0030993629376133464, 0.003137668496050154, 0.0031399367947508097, 0.003148625450645613, 0.0031705268838949033, 0.003178452237318739, 0.0031857217816552087, 0.0032021888968821496, 0.003202467435749716, 0.003204446716074623, 0.003204446716074623, 0.003204446716074623, 0.00320779718914793, 0.0032092099230808416, 0.0032152636418965033, 0.0032152636418965033, 0.0032401885741727334, 0.0032444075641103673, 0.003250529552736747, 0.0032630952905269945, 0.0032797338059276353, 0.003284984516528309, 0.003289067209960469, 0.003289067209960469, 0.0033052447910992488, 0.003306280783316256, 0.003306280783316256, 0.003309195883219975, 0.003309195883219975, 0.0033172200303447086, 0.003317483675806682, 0.003325923655068783, 0.0033485775806955482, 0.0033626448358383696, 0.003383219232606273, 0.003389480078923135, 0.0034015044734691533, 0.0034015044734691533, 0.003402239457401501, 0.003419888202398719, 0.003419888202398719, 0.0034238559961234215, 0.003430331834439248, 0.0034409571552178287, 0.0034409571552178287, 0.0034535667801639082, 0.0034550249097922278, 0.0034550249097922278, 0.0034652247639949296, 0.0034883681521117454, 0.003491047136957193, 0.003491047136957193, 0.0034946522064323114, 0.00349474104182925, 0.003499120754259425, 0.0035006928878499616, 0.003505223455421225, 0.0035120731367245532, 0.0035142592457501538, 0.0035142592457501538, 0.0035214386213406946, 0.003526708285762868, 0.003528132526814683, 0.003528132526814683, 0.0035325815368379117, 0.00353502302179836, 0.003537003220918415, 0.003537026804438977, 0.0035386044310619113, 0.0035420540390561192, 0.003544102840048254, 0.0035496810403079083, 0.003550225058447682, 0.0035814423313181927, 0.0035925250552269897, 0.0036104974492464368, 0.003610906242924124, 0.003610906242924124, 0.003610906242924124, 0.003610906242924124, 0.0036132317134675725, 0.0036132317134675725, 0.003614097465223906, 0.003614097465223906, 0.003634651646643849, 0.003634651646643849, 0.003634651646643849, 0.003634651646643849, 0.0036385441249349657, 0.0036385441249349657, 0.0036408219988342473, 0.0036462885677699766, 0.003651024663811435, 0.003654811880178798, 0.003654811880178798, 0.003667696569358619, 0.003667696569358619, 0.0036795665139017115, 0.0036795665139017115, 0.003682994498593944, 0.003684992523817369, 0.0036858716021174968, 0.003687635826645845, 0.003687635826645845, 0.003694526760283771, 0.003694526760283771, 0.0037047244338153677, 0.0037062675527854316, 0.0037062675527854316, 0.0037066879439802015, 0.0037068958544061096, 0.003713241954453144, 0.0037141409022868398, 0.003718740032528555, 0.003718740032528555, 0.003725076070820191, 0.003734587611594509, 0.003734587611594509, 0.003734587611594509, 0.003735524511354979, 0.003741934869457976, 0.0037449141750351403, 0.0037464128167205993, 0.0037464128167205993, 0.003747261080142331, 0.0037544709055416987, 0.0037715313829983516, 0.0037715313829983516, 0.0037724850743998737, 0.0037724850743998737, 0.0037899834681264103, 0.003794502143669903, 0.003794502143669903, 0.0037995622697479764, 0.003821430407529925, 0.003838266143679049, 0.003841809926342344, 0.003851782957233526, 0.003855608182618945, 0.003855608182618945, 0.003855608182618945, 0.003861015899246847, 0.0038646766333732137, 0.003866290912745436, 0.003877848053352862, 0.0038869334883774595, 0.0038954722599251184, 0.0038982158067323125, 0.0038982158067323125, 0.0038982158067323125, 0.00390116065795874, 0.003921020435861302, 0.003925607744855607, 0.003925926129674558, 0.0039369434195236745, 0.003941592917874111, 0.003941592917874111, 0.003941592917874111, 0.0039533488822091935, 0.0039643061837674526, 0.003980066825101555, 0.003980066825101555, 0.003980066825101555, 0.00400947873943251, 0.004014484338660648, 0.004014484338660648, 0.0040156850841343295, 0.004028661057038219, 0.004032896985521136, 0.004032896985521136, 0.004037503001758566, 0.004037503001758566, 0.004037503001758566, 0.00403980523368208, 0.004039974050350015, 0.004047406862163591, 0.004052239957749085, 0.004098889690096875, 0.0041048683184715115, 0.0041048683184715115, 0.0041048683184715115, 0.004105924997114726, 0.00412478340622311, 0.004125547581695974, 0.004128835926843145, 0.004132898535229338, 0.004142911957895084, 0.0041697600815567195, 0.004190579724706015, 0.004196807326481861, 0.004197309228193156, 0.004197309228193156, 0.004197532132717365, 0.004201995877287806, 0.004203938057611763, 0.004204744638779438, 0.004210813908878143, 0.004212841620630592, 0.004212841620630592, 0.004222761635829508, 0.004223205059268068, 0.004223205059268068, 0.004223504196193731, 0.004224566482545067, 0.004237895006522616, 0.004241418541061148, 0.004245887983880846, 0.004247174644245445, 0.004247174644245445, 0.004249602294524709, 0.0042594904979040395, 0.004263431014636122, 0.004264026543115414, 0.004267152037048927, 0.004276671211746554, 0.004281314191159896, 0.004281314191159896, 0.004281314191159896, 0.004284280462514824, 0.004292055336961643, 0.004300523340559821, 0.004304039890072312, 0.004316346524631585, 0.004336533013774837, 0.0043410572485089675, 0.004351463215032227, 0.004351463215032227, 0.004362595126739359, 0.004363116888390076, 0.004364160643140626, 0.004364160643140626, 0.004381710656077863, 0.004386671626720519, 0.004389396114776105, 0.004389396114776105, 0.004391238959550259, 0.004393275613964302, 0.0043987352633295005, 0.004400842034642739, 0.00440259033132226, 0.004405741083009926, 0.004408355622111374, 0.004410185837010538, 0.004410185837010538, 0.004412039151488759, 0.004433367591640973, 0.004442024283430893, 0.004444749940634597, 0.004449406336229264, 0.004452492259943876, 0.004452492259943876, 0.00445286490869637, 0.004458789279543438, 0.0044620430221720365, 0.004469926537481835, 0.004469926537481835, 0.004472378004489147, 0.0044731428404090985, 0.004482700126028816, 0.004487432281661054, 0.004487432281661054, 0.004491410557507178, 0.004497264720287144, 0.004498222754256358, 0.004498222754256358, 0.004500325178347673, 0.00450797869317495, 0.004524370078380889, 0.004526751860269633, 0.004541291740388986, 0.0045475683820499204, 0.004567780550889159, 0.004573815665881565, 0.004577466022700215, 0.004578769826073347, 0.004580862046995619, 0.004580862046995619, 0.004590302039815002, 0.004597884972912461, 0.004611867097431023, 0.0046299362135090874, 0.004644066817431406, 0.004647012182482552, 0.004648597692559629, 0.004651698265727148, 0.004675681797337482, 0.004677175525627952, 0.00468001916515835, 0.004687860826726195, 0.0046912438283412735, 0.0046912438283412735, 0.004713412211253564, 0.004722806539352836, 0.004722806539352836, 0.004722806539352836, 0.0047360149400822215, 0.004739353255122215, 0.004740197840739619, 0.004744275037177238, 0.004750675545826304, 0.004750675545826304, 0.004750675545826304, 0.004751221956929872, 0.004753331968550424, 0.004753331968550424, 0.004770307340038843, 0.004772533145909698, 0.004772533145909698, 0.0047766846937785405, 0.004783442239875289, 0.004788384074175824, 0.004788384074175824, 0.004800011853966002, 0.004803135681288278, 0.004803135681288278, 0.004803135681288278, 0.0048129349739909465, 0.0048129349739909465, 0.004814455882716163, 0.004815645843174056, 0.004815645843174056, 0.0048259181004990884, 0.004840446355133009, 0.004855507929112646, 0.004855516944803123, 0.004855516944803123, 0.00485624635143024, 0.004857875098974629, 0.004858088023881878, 0.004860675317194733, 0.004860675317194733, 0.004862708294775674, 0.004862708294775674, 0.004862892051576325, 0.004869223779032291, 0.004874579737781098, 0.004874579737781098, 0.004880932832413731, 0.004891903776859644, 0.004913353388603354, 0.004919207148295564, 0.004919207148295564, 0.0049361430427084735, 0.004942429751332876, 0.004948429864024512, 0.004960844084172207, 0.004969696660478234, 0.004969696660478234, 0.004976239597981591, 0.004984416418450375, 0.004987024492485336, 0.004989866006135089, 0.004989870948356037, 0.005005812207399426, 0.005006458538575093, 0.0050074861743582225, 0.0050074861743582225, 0.0050100842990452345, 0.005011526809048485, 0.005011526809048485, 0.005013429104871074, 0.0050263402272228965, 0.005036944030255968, 0.005036944030255968, 0.005040683081527005, 0.005047049573378986, 0.005048926201278073, 0.005049261450325186, 0.005056218051477702, 0.005057890763378439, 0.005080151506421442, 0.005090405724529097, 0.005105685743854176, 0.005106075158327071, 0.0051062747771761785, 0.0051141240594877535, 0.0051185721691377455, 0.00512186512713588, 0.0051344561193034195, 0.0051344561193034195, 0.005143980641057241, 0.005147660136352654, 0.005147660136352654, 0.005162550874057745, 0.005162550874057745, 0.005163631700246979, 0.005165155284668027, 0.005167115475440727, 0.00518394139712727, 0.005189333361207218, 0.00519872113781266, 0.0052060250480263645, 0.0052100340237117935, 0.005225954807095927, 0.005238558244551229, 0.005245018651223582, 0.005248830808861822, 0.005287764232820223, 0.005330552160223431, 0.005331364027679092, 0.005331908953143022, 0.005331908953143022, 0.005348471832430339, 0.005348471832430339, 0.005348471832430339, 0.005362637338085487, 0.005362637338085487, 0.005368296708643692, 0.005377930276927639, 0.005393106868470862, 0.005396431336233182, 0.005397956683875768, 0.005419336490019218, 0.005419336490019218, 0.005427633128154522, 0.0054447251502744145, 0.0054499237254372265, 0.0054499237254372265, 0.005465561637959702, 0.0054786819221306, 0.0054786819221306, 0.0054786819221306, 0.005479218059907257, 0.005481354128551775, 0.005488098595463407, 0.005490918533678591, 0.00550534911376025, 0.005505719347884551, 0.005506112296558463, 0.005506112296558463, 0.005512550590821475, 0.00552440409206089, 0.005535232721969696, 0.0055369953000442215, 0.005540370694012301, 0.005544719925593436, 0.005551977721601383, 0.005557527423770032, 0.005557527423770032, 0.005559680606877798, 0.0055629163965081425, 0.005569136859952649, 0.0056011344069684995, 0.0056011344069684995, 0.005606662950337031, 0.005606662950337031, 0.005616480085294342, 0.005628243036792338, 0.005628686466986384, 0.005628686466986384, 0.005629710873714072, 0.005641015568055431, 0.005641751076401749, 0.005641751076401749, 0.0056518291489051, 0.005666548926640383, 0.005684795091926754, 0.005684795091926754, 0.005688440220221458, 0.005691320943428739, 0.005695346910135697, 0.005695346910135697, 0.005705529681725615, 0.005705529681725615, 0.0057121064011474995, 0.005731903699962846, 0.005736654374729458, 0.0057386247043393155, 0.0057492697947324235, 0.0057492697947324235, 0.005749916468102465, 0.005757793822354993, 0.005760456675258079, 0.0057943397473979455, 0.005797040361279725, 0.005825996707576042, 0.005825996707576042, 0.005829601504678969, 0.005836590557660043, 0.005857395251273875, 0.005869331820694018, 0.005869331820694018, 0.005944425776804999, 0.005944425776804999, 0.005944425776804999, 0.005953814769899096, 0.005955335271693924, 0.005955335271693924, 0.005966047657972514, 0.005966047657972514, 0.0059786767604175315, 0.005997533173533249, 0.006006888208825085, 0.006024216080387139, 0.006065886431359569, 0.006107770644181594, 0.006116145305680413, 0.006117640469027143, 0.006117640469027143, 0.006135666158267998, 0.006135666158267998, 0.006144360510770055, 0.006148081327926129, 0.006151801770244559, 0.006160811118532855, 0.006177415965567157, 0.006193991825202298, 0.0061942930267539775, 0.006208127791412705, 0.0062217272324237875, 0.006255201080074262, 0.006258170985233289, 0.006281269758207348, 0.006294164623549484, 0.006304354833195618, 0.006313060866774468, 0.006313060866774468, 0.00633976314641357, 0.006365584985584036, 0.006365584985584036, 0.006384116456959907, 0.006398926429924144, 0.0064220978969986965, 0.006447893228788331, 0.0064941429017029905, 0.006538683908549255, 0.006547344732877416, 0.006571201149090154, 0.006601305842336727, 0.006601305842336727, 0.006617071400973646, 0.006627090724305365, 0.00665918477248137, 0.0066883464352343516, 0.0067290685195940695, 0.006729928136929794, 0.0067456520172990645, 0.0067486456890376795, 0.006753665908047738, 0.006753665908047738, 0.006763350152881009, 0.006800874861439125, 0.006800874861439125, 0.006816149324749351, 0.006820665323081073, 0.0068275932267230915, 0.00685191592911714, 0.0068528786890606425, 0.00685579196217494, 0.006904065721000126, 0.00690761049268387, 0.00690761049268387, 0.006908295291376177, 0.006944382534489179, 0.006957907114730978, 0.006957907114730978, 0.006999832772630943, 0.006999832772630943, 0.007020288055717482, 0.007061664488319318, 0.007083183040666965, 0.0070975062511678955, 0.007133432728372462, 0.007133432728372462, 0.007134210569730256, 0.007146422500730196, 0.007146422500730196, 0.007146422500730196, 0.007155324278195742, 0.007155324278195742, 0.007157179265293387, 0.007208284579883355, 0.007208284579883355, 0.007226305473143432, 0.007238553562915751, 0.007253480154960557, 0.007255928227168203, 0.007299361213489687, 0.007299361213489687, 0.00731675178598692, 0.007341442859281024, 0.007341442859281024, 0.007348831398944251, 0.007354476938028386, 0.007354476938028386, 0.0073635908817860736, 0.007387597492580189, 0.007396395992687655, 0.007453977445242765, 0.007470172397860092, 0.007472777307605734, 0.007477083173363463, 0.007484303600745577, 0.007487401277685061, 0.007493784810433601, 0.007493823218769629, 0.007493930661870312, 0.007513066586399383, 0.007598359979428995, 0.007622963897642982, 0.007656706006046476, 0.007663677652635988, 0.007697674696045679, 0.007767661736508777, 0.007767661736508777, 0.007774888801076463, 0.007774888801076463, 0.0077829071813584425, 0.00784332961658196, 0.007843998683275216, 0.007844965355712611, 0.007844965355712611, 0.00786384036718029, 0.007921600618857832, 0.007921600618857832, 0.00792654283145358, 0.007929085880608809, 0.007934187080550882, 0.007956278467560574, 0.00796076316173701, 0.007966345040645454, 0.008061213808026699, 0.008096833025072765, 0.008117537658365735, 0.008164425991257917, 0.008199507054809214, 0.008220431138021497, 0.008220431138021497, 0.008286984393886263, 0.00828863515133045, 0.008292421885832613, 0.008306874956865556, 0.008314801051888834, 0.008319876237075011, 0.008329005889757532, 0.008329005889757532, 0.008351654049980868, 0.008351793745597306, 0.008365904145706258, 0.008460394360352144, 0.008488553542543123, 0.008502368270356922, 0.008512728933773507, 0.00853022316636833, 0.00854284398753322, 0.008573643160906471, 0.008573643160906471, 0.00858762922555613, 0.008605331336762194, 0.008619011526137308, 0.008640091887221608, 0.008646791185345795, 0.008657241778032957, 0.00870325384228253, 0.008736485209485625, 0.008785201818538086, 0.00879238021786043, 0.00879238021786043, 0.008834346018548128, 0.008834346018548128, 0.008834346018548128, 0.008855098572324553, 0.008855098572324553, 0.008855098572324553, 0.008870918006099167, 0.008936605069115153, 0.008936605069115153, 0.00897141712829448, 0.0089875178584856, 0.0089875178584856, 0.009079908784943679, 0.009100813581898683, 0.009109885432819808, 0.009109885432819808, 0.009139085069028809, 0.009303945306990014, 0.009303945306990014, 0.009316482892856104, 0.009329580762979656, 0.009375529174622468, 0.0094443088720382, 0.009503114451961055, 0.009508557276697775, 0.009537922752185594, 0.009537922752185594, 0.009565024632975589, 0.009565024632975589, 0.009595009909784348, 0.00967941530772867, 0.009687095253303425, 0.009687095253303425, 0.009721884038888979, 0.009753086749320928, 0.009811467288979378, 0.009894722814498933, 0.009983189281719665, 0.010022025282912147, 0.010146017441655227, 0.010160500377401026, 0.010209800520361252, 0.010209800520361252, 0.010224013412499218, 0.010224013412499218, 0.010224013412499218, 0.010224363089087448, 0.010229944463017273, 0.010285584528584779, 0.01044491325626454, 0.01046637025181819, 0.010510830274417956, 0.010630023014866753, 0.010633032602732911, 0.010640474883962055, 0.010723355731777063, 0.010743124111265604, 0.010771858794191834, 0.010771858794191834, 0.01087041672996404, 0.01087041672996404, 0.01087041672996404, 0.0109149618492287, 0.010917186606513498, 0.010917186606513498, 0.010944744746153999, 0.011123078626576608, 0.011132724656958132, 0.011219814575247952, 0.011231320868993259, 0.011364575043168427, 0.011364575043168427, 0.011399718338733822, 0.011399718338733822, 0.01157673514106288, 0.01157673514106288, 0.011616682550228342, 0.01164196014072942, 0.011744906526498618, 0.011797664141414142, 0.011843072375412041, 0.011843072375412041, 0.011890178248773442, 0.011903438501552671, 0.011903438501552671, 0.011978797799324032, 0.01223112742710518, 0.01223112742710518, 0.01251612197617082, 0.012697793646322425, 0.012703601891101483, 0.012980534682464585, 0.013037786926958311, 0.013037786926958311, 0.013113879841430134, 0.013282077172879533, 0.013410567185597454, 0.013410567185597454, 0.013410567185597454, 0.013553296865683313, 0.013553296865683313, 0.013612544517769136, 0.013616250860779958, 0.013624490089651208, 0.013751939983721328, 0.013814525537596161, 0.014239079956098565, 0.014373973236522014, 0.014456553435270907, 0.015456487241966374, 0.015456487241966374, 0.015625480346342674, 0.01562929924781643, 0.015946298203937122, 0.015951994910433313, 0.016041286291421313, 0.016147241303226933, 0.016547302510793487, 0.01656960537323336, 0.01683296833699911, 0.01683296833699911, 0.01683296833699911, 0.01736717055614493, 0.01736717055614493, 0.0179180977965684, 0.01813301169346529, 0.018742417269798767, 0.019350555142096857, 0.020197924181296775, 0.02166097647259618, 0.0228866817954516, 0.029802940002426045, 0.03021664278421656, 0.031051731845829378, 0.03192231059810666, 0.03192231059810666, 0.041670877314993526, 0.041670877314993526, 0.041670877314993526, 0.04189647418097729, 0.04441154651105693, 0.045293567661538914, 0.07707628434712026] 

	def rental?
		price.include?("/mo") if price
	end

	def person_count
    case
    when beds == nil
    	nil
    when beds.to_i >= 7
      7
    when beds.to_i <= 1
      2
    else
    	beds.to_i
    end
	end

	def room_demand
		census_record = CensusRecord.cached_find_by_zip(zip)
		if census_record && person_count
			households = census_record.send(:"households#{person_count}_person")
			similar_count = similar_properties.count
			similar_count > 0 ? (households / similar_count) : households
		end
	end

	def room_demand_grade
		if room_demand
			room_demand_with_samples = (SAMPLE_ROOM_DEMANDS + [room_demand]).sort { |x,y| x<=>y }
			place_in_list = room_demand_with_samples.index(room_demand).to_f
			list_length = room_demand_with_samples.length.to_f
			((place_in_list/list_length)*100).round
		end
	end

  def credit_score_grade
  	avg_credit_score = CensusRecord.find_by_zip(zip).try(:credit_score)
  	((avg_credit_score - 400)/4).round if avg_credit_score
  end

	def similar_properties
		no_of_beds = beds.to_s.split(" ")[0].to_i
		no_of_bathrooms = bathrooms.to_s.split(" ")[0].to_i
		Property.where(zip: zip)
						.where(beds: bed_formats(no_of_beds))
						.where(bathrooms: bathroom_formats(no_of_bathrooms))
	end

	def bed_formats(no_of_beds)
		[no_of_beds, no_of_beds.to_s, "#{no_of_beds} bd", "#{no_of_beds} bds"]
	end

	def bathroom_formats(no_of_bathrooms)
		[no_of_bathrooms, no_of_bathrooms.to_s, "#{no_of_bathrooms} ba"]
	end

	def cap_ratio
		avg_purchase_price_in_zip = Property.avg_purchase_price_for(Property.where(zip: zip))
		avg_rental_price_in_zip = Property.avg_rental_price_for(Property.where(zip: zip))
		if (avg_rental_price_in_zip && avg_purchase_price_in_zip) && avg_purchase_price_in_zip != 0
      avg_rental_price_in_zip / avg_purchase_price_in_zip
    end
	end

	def cap_ratio_grade
		if cap_ratio
			cap_ratio_with_samples = (SAMPLE_CAP_RATIOS + [cap_ratio]).sort { |x,y| x<=>y }
			place_in_list = cap_ratio_with_samples.index(cap_ratio).to_f
			list_length = cap_ratio_with_samples.length.to_f
			((place_in_list/list_length)*100).round
		end
	end

	def score
		if room_demand && cap_ratio
		  (room_demand + (100000 * cap_ratio)).round(5)
		end
	end

	def top_ten_in_state(state)
		Property.where(state: state).sort_by { |p| p.score }.first(10).map { |p| "Property #{p.id} has a score of #{p.score}" }
	end

private

	def self.avg(arr)
		(arr.reduce(:+).to_f / arr.size)
	end

	def self.avg_purchase_price_for(properties)
		properties = properties.reject { |p| p.price.nil? }
    purchase_prices = properties.map { |p| p.price[1..-1].to_i unless p.rental? }
    purchase_prices.compact!
		purchase_prices.reject! { |x| x == 0 }    													
    avg(purchase_prices.compact) unless purchase_prices.empty?
  end

  def self.avg_rental_price_for(properties)
  	properties = properties.reject { |p| p.price.nil? }
  	rental_prices = properties.map { |p| p.price[1..-1].to_i if p.rental? }
    rental_prices.compact!
    rental_prices.reject! { |x| x == 0 }
    avg(rental_prices) unless rental_prices.empty?
  end
end
